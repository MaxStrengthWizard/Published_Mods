Version 1
SubGoalCombiner SGC_AND
INITSECTION
DB_AstarionOPAscendedPassivesRetro("AscendantImmunities");
DB_AstarionOPAscendedPassivesRetro("AscendantOPNaturalArmor");
DB_AstarionOPAscendedPassivesRetro("AscendantOPMovementBuff");
DB_AstarionOPAscendedPassivesRetro("AscendantOPSavingThrows");
DB_AstarionOPAscendedPassivesRetro("AscendantOPSkillProficiencies");
DB_AstarionOPAscendedPassivesRetro("AscendantBlindsight");
DB_AstarionOPAscendedPassivesRetro("LOW_Astarion_OPVampireAscendant");

DB_AstarionAscendedOldPassivesRetro("VampiricResistance");
DB_AstarionAscendedOldPassivesRetro("AscendantSavingThrows");
DB_AstarionAscendedOldPassivesRetro("AscendantSkillProficiencies");
DB_AstarionAscendedOldPassivesRetro("SuperiorDarkvision");

KBSECTION
IF
SavegameLoaded()
AND
DB_GlobalFlag((FLAG)ORI_Astarion_State_BecameVampireLord_c446ce94-efd8-45d5-b407-284177b6b57e)
AND
DB_AstarionOPAscendedPassivesRetro(_OPAscendedVampPassive)
AND
HasPassive(S_Player_Astarion_c7c13742-bacd-460a-8f65-f864fe41f255, _OPAscendedVampPassive, 0)
AND
HasPassive(S_Player_Astarion_c7c13742-bacd-460a-8f65-f864fe41f255, "LOW_Astarion_VampireAscendant", 1)
THEN
AddPassive(S_Player_Astarion_c7c13742-bacd-460a-8f65-f864fe41f255, _OPAscendedVampPassive);
RemovePassive(S_Player_Astarion_c7c13742-bacd-460a-8f65-f864fe41f255, "LOW_Astarion_VampireAscendant");
PROC_Astarion_OldPassiveCleanupRetro();
PROC_Astarion_OPAscendedWrapUp();

PROC
PROC_Astarion_OldPassiveCleanupRetro()
AND
DB_AstarionAscendedOldPassivesRetro(_AscendedOPOldPassives)
AND
HasPassive(S_Player_Astarion_c7c13742-bacd-460a-8f65-f864fe41f255, _AscendedOPOldPassives, 1)
THEN
RemovePassive(S_Player_Astarion_c7c13742-bacd-460a-8f65-f864fe41f255, _AscendedOPOldPassives);

PROC
PROC_Astarion_OPAscendedWrapUp()
AND
QRY_OnlyOnce("ORI_Astarion_TrueVampire_AscendedOP")
THEN
DB_NOOP(1);

IF
LevelGameplayReady(_LevelName, _IsEditor)
AND
IsGameLevel(_LevelName, 1)
AND
QRY_OnlyOnce_IsSet("ORI_Astarion_TrueVampire_AscendedOP")
THEN
GoalCompleted;

EXITSECTION

ENDEXITSECTION
